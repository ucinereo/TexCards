<div>
  <div class="container sticky-top" style="height: 100%;">
    <div class="row">
      <div class="col col-md-8">
        <h1 class="text-primary d-inline">Edit Flashcardset</h1>
        <div [hidden]="!flashcardSet?.owner" style="display: inline;">
          <i (click)="onDelete()" class="material-icons d-inline text-primary fs-1 align-text-bottom pointer" style="margin-left: 20px;">delete</i>
        </div>
        <div class="input-group">
          <input class="form-control border-radius-3" type="text" placeholder="Flashcardset Name" [(ngModel)]="flashcardSetName" tabindex="1"/>
        </div>
      </div>
      <div class="w-100 d-md-none d-lg-none d-xl-none d-xxl-none"></div>
      <div class="col col-md-4 d-flex align-items-end justify-content-end">
        <h5 class="fst-italic text-secondary mt-1">@ {{ flashcardSet?.author }}</h5>
      </div>
    </div>
    <div class="row mt-3">
      <div class="col">
        <div class="input-group input-group-sm"><input class="form-control border-radius-3" type="text" placeholder="Description" [(ngModel)]="flashcardSetDescription" tabindex="2"/></div>
      </div>
    </div>
    <div class="row mt-3">
      <div class="col">
        <ng-select [items]="tags" [(ngModel)]="selectedTags" [hideSelected]="true" [addTag]="true" [multiple]="true" bindLabel="name" placeholder="Tags" [addTagText]="'Add tag'" [notFoundText]="'No tag found'" [tabIndex]="3">
        </ng-select>
      </div>
    </div>
    <div class="row" style="height: 100%;">
      <div class="col-md-8 overflow-auto" style="height: 100%;max-height: 100%;">
        <div *ngFor="let card of flashcardList; let i = index" class="row" style="margin-top: 20px;max-height: 10%;height: 10%;min-height: 10%;">
          <div class="col-md-6 col-xl-6" style="max-width: 48%;">
            <span #tSpans (input)="onChange(i, $event)" (focusin)="onFocusIn(i)" tabindex="{{ 2 * i + 4 }}"
                  class="term" style="width: 100%;padding-bottom: 0px;display: block;height: 100%;text-align: left;border-bottom: 2px solid var(--bs-blue);" contenteditable="true">
            </span>
          </div>
          <div class="col-md-6 col-xxl-5" style="min-width: 52%;max-width: 52%;">
            <div class="row" style="height: 100%;min-height: 100%;max-height: 100%;margin-right: -10px;">
              <div class="col-md-6 col-xl-9" style="max-width: 90%;min-width: 90%;">
                <span #dSpans (input)="onChange(i, $event)" (focusin)="onFocusIn(i)" tabindex="{{ 2 * i + 5 }}"
                      class="definition" style="width: 100%;padding-bottom: 0px;display: block;height: 100%;text-align: left;border-bottom: 2px solid var(--bs-blue);" contenteditable="true" role="textbox">
                </span>
              </div>
              <div class="col-auto col-xl-1" style="max-width: 10%;min-width: 10%;padding-right: 0px;padding-left: 1px;">
                <div class="btn-group-vertical btn-group-sm" role="group">
                  <button (click)="setAlignment(i, 1)" class="btn btn-primary" type="button" style="background: rgba(255,255,255,0);border-style: none;padding: 0;">
                    <i [style.color]="flashcardList[i].alignment == 1? 'var(--bs-primary)' : 'var(--bs-btn-disabled-color)'" class="material-icons" style="margin: 0;">format_align_left</i>
                  </button>
                  <button (click)="setAlignment(i, 2)" class="btn btn-primary" type="button" style="background: #00000000;border-style: none;padding: 0;">
                    <i [style.color]="flashcardList[i].alignment == 2? 'var(--bs-primary)' : 'var(--bs-btn-disabled-color)'" class="material-icons" style="margin: 0;">format_align_center</i>
                  </button>
                  <button (click)="setAlignment(i, 3)" class="btn btn-primary" type="button" style="background: rgba(0,0,0,0);border-style: none;padding: 0;">
                    <i [style.color]="flashcardList[i].alignment == 3? 'var(--bs-primary)' : 'var(--bs-btn-disabled-color)'" class="material-icons" style="margin: 0;">format_align_right</i>
                  </button>
                  <button class="btn btn-primary" (click)="onRemove(i)" type="button" style="background: rgba(255,255,255,0);border-style: none;padding: 0;"><i class="material-icons" style="margin: 0;color: var(--bs-white);">delete</i>
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="d-block d-print-none d-sm-block d-md-none d-lg-none d-xl-none d-xxl-none text-end mt-3 fw-bold">
          <div class="d-inline-flex w-100 justify-content-end position-relative" role="group">
            <button (click)="openImportDialog()" class="btn btn-primary d-flex align-items-center text-primary bg-transparent border-0" style="margin-right: auto;" type="button">
              <svg xmlns="http://www.w3.org/2000/svg" width="28px" height="28px" viewBox="0 0 24 24" fill="none">
                <path d="M5 9.98193V19.9819H19V9.98193H15V7.98193H21V21.9819H3V7.98193H9V9.98193H5Z" fill="currentColor"></path>
                <path d="M13.0001 2H11.0001V14.0531L8.46451 11.5175L7.05029 12.9317L12 17.8815L16.9498 12.9317L15.5356 11.5175L13.0001 14.053V2Z" fill="currentColor"></path>
              </svg>
            </button>
            <button routerLink="/view/{{ flashcardSet?.id }}" class="btn btn-primary d-flex align-items-center text-primary bg-transparent border-0" type="button">
              <i class="material-icons" style="font-size: 28px;">close</i>
            </button>
            <button (click)="onSubmit()" class="btn btn-primary d-flex align-items-center text-primary bg-transparent border-0" type="button">
              <i class="material-icons" style="font-size: 28px;">check</i>
            </button>
          </div>
        </div>
      </div>
      <div class="col-md-4 col-xxl-4 d-none d-print-block d-sm-none d-md-block d-lg-block d-xl-block d-xxl-block align-self-start" style="position: sticky;top: 0px;bottom: 0px;height: 100%;margin-top: -30px;padding-top: 50px;">
        <div class="d-flex align-items-center justify-content-center" style="width: 100%;background: var(--bs-dark);max-height: 50%;min-height: 200px; border-radius: 3px;">
          <card [paragraph]="checkPreviewBounds() ? flashcardList[focusIndex].term : 'Term Preview'" [align]="checkPreviewBounds() ? flashcardList[focusIndex].alignment : 0"></card>
        </div>
        <div class="d-flex align-items-center justify-content-center" style="width: 100%;background: var(--bs-dark);margin-top: 30px;max-height: 50%;min-height: 200px; border-radius: 3px;">
          <card [paragraph]="checkPreviewBounds() ? flashcardList[focusIndex].definition : 'Definition Preview'" [align]="checkPreviewBounds() ? flashcardList[focusIndex].alignment : 0"></card>
        </div>
        <div class="text-end mt-3 fw-bold">
          <div class="d-inline-flex w-100 justify-content-end position-relative" role="group">
            <button (click)="openImportDialog()" class="btn btn-primary d-flex align-items-center text-primary bg-transparent border-0" style="margin-right: auto;" type="button">
              <svg xmlns="http://www.w3.org/2000/svg" width="28px" height="28px" viewBox="0 0 24 24" fill="none">
                <path d="M5 9.98193V19.9819H19V9.98193H15V7.98193H21V21.9819H3V7.98193H9V9.98193H5Z" fill="currentColor"></path>
                <path d="M13.0001 2H11.0001V14.0531L8.46451 11.5175L7.05029 12.9317L12 17.8815L16.9498 12.9317L15.5356 11.5175L13.0001 14.053V2Z" fill="currentColor"></path>
              </svg>
            </button>
            <button routerLink="/view/{{ flashcardSet?.id }}" class="btn btn-primary d-flex align-items-center text-primary bg-transparent border-0" type="button">
              <i class="material-icons" style="font-size: 28px;">close</i>
            </button>
            <button (click)="onSubmit()" class="btn btn-primary d-flex align-items-center text-primary bg-transparent border-0" type="button">
              <i class="material-icons" style="font-size: 28px;">check</i>
            </button></div>
        </div>
      </div>
    </div>
  </div>
</div>

<!--form modal-->
<div class="modal fade" id="importModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-xl modal-fullscreen-md-down">
    <div class="modal-content">
      <div class="modal-header">
        <h1 class="modal-title fs-5" id="exampleModalLabel">Import flashcards</h1>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body" style="height: 70vh;">
        <div class="h-100 d-flex flex-column justify-content-center">
          <form [formGroup]="iForm">
            <div class="row">
              <div class="col d-flex justify-content-center">
                <div>
                  <h5>Term-Definition separator</h5>
                  <div class="form-check">
                    <input id="tdSep1" class="form-check-input" type="radio" name="tdSep" formControlName="tdSep" value="\t" checked />
                    <label class="form-check-label" for="tdSep1">Tab</label>
                  </div>
                  <div class="form-check">
                    <input id="tdSep2" class="form-check-input" type="radio" name="tdSep" formControlName="tdSep" value=";" />
                    <label class="form-check-label" for="tdSep2">Semicolon</label>
                  </div>
                  <div class="form-check">
                    <input id="tdSep3" class="form-check-input" type="radio" name="tdSep" formControlName="tdSep" value="tdCustom"/>
                    <label class="form-check-label" for="tdSep3">Custom<input formControlName="tdCustomInput" class="bg-transparent text-white outline-none" type="text" placeholder="=" style="border-color: var(--bs-body-color);border-top-width: 0px;border-right-width: 0px;border-bottom-width: 1px;border-left-width: 0px;width: 30px;text-align: left;margin-left: 10px;" />
                    </label>
                  </div>
                </div>
              </div>
              <div class="col d-flex justify-content-center">
                <div>
                  <h5>Card separator</h5>
                  <div class="form-check">
                    <input id="cSep1" class="form-check-input" type="radio" name="cSep" formControlName="cSep" value="\n" checked />
                    <label class="form-check-label" for="cSep1">Newline</label>
                  </div>
                  <div class="form-check">
                    <input id="cSep2" class="form-check-input" type="radio" name="cSep" formControlName="cSep" value=";" />
                    <label class="form-check-label" for="cSep2">Semicolon</label>
                  </div>
                  <div class="form-check">
                    <input id="cSep3" class="form-check-input" type="radio" name="cSep" formControlName="cSep" value="cCustom" />
                    <label class="form-check-label" for="cSep3">Custom<input formControlName="cCustomInput" class="bg-transparent text-white outline-none" type="text" placeholder="\n\n" style="border-color: var(--bs-body-color);border-top-width: 0px;border-right-width: 0px;border-bottom-width: 1px;border-left-width: 0px;width: 30px;text-align: left;margin-left: 10px;" /></label>
                  </div>
                </div>
              </div>
              <div class="col d-flex justify-content-center">
                <div>
                  <h5>Alignment</h5>
                  <div class="form-check">
                    <input id="align1" class="form-check-input" type="radio" name="align" formControlName="align" value="1" checked />
                    <label class="form-check-label" for="align1"><i class="material-icons">format_align_left</i></label>
                  </div>
                  <div class="form-check">
                    <input id="align2" class="form-check-input" type="radio" name="align" formControlName="align" value="2" />
                    <label class="form-check-label" for="align2"><i class="material-icons">format_align_center</i></label>
                  </div>
                  <div class="form-check">
                    <input id="align3" class="form-check-input" type="radio" name="align" formControlName="align" value="3" />
                    <label class="form-check-label" for="align3"><i class="material-icons">format_align_right</i></label>
                  </div>
                </div>
              </div>
            </div>
          </form>
          <div class="flex-grow-1 d-flex justify-content-center align-items-center">
            <textarea [(ngModel)]="importText" style="resize: none;height: 99%;width: 99%;">
            </textarea>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary btn-danger" data-bs-dismiss="modal">Close</button>
        <button (click)="import()" type="button" class="btn btn-primary">Import</button>
      </div>
    </div>
  </div>
</div>
